!function(t){function e(s){if(n[s])return n[s].exports;var i=n[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";var s=function(t,e,n,s,i,r,o,u){if(!t){var c;if(void 0===e)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=[n,s,i,r,o,u],p=0;c=new Error("Invariant Violation: "+e.replace(/%s/g,function(){return a[p++]}))}throw c.framesToPop=1,c}};t.exports=s},function(t,e,n){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),r=n(3),o=function(){function t(e){var n=this,i=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];s(this,t),this.emitter=new r.EventEmitter,this.url=e,this.protocols=i&&i.length>0?i:null,this.reconnectAttempts=0,this.forcedClose=!1,this.ws=null,this.sendTries={},this.settings={autoOpen:!0,autoReconnect:!0,debug:!1,reconnectInterval:1e3,reconnectDecay:1.5,timeoutInterval:2e3,binaryType:"blob",maxReconnects:null,maxSendTries:10,maxReconnectTimeout:5e3,onBeforeWsOpen:null,onWsOpen:null,onWsMessage:null,onWsClose:null,onWsError:null,onWsTimeout:null};for(var u in o)this.settings[u]=o[u];for(var c=["onBeforeWsOpen","onWsOpen","onWsMessage","onWsClose","onWsError","onWsTimeout"],a=function(){var t=c[p];"function"==typeof n.settings[t]&&n.emitter.addListener(t,function(e){n.settings[t](e,n)})},p=0;p<c.length;p++)a();this.emitter.addListener("onWsMessage",function(t){var e=JSON.parse(t.data),s=typeof e;"object"===s&&e.type&&n.emitter.emit(e.type,t,e)}),this.settings.autoOpen&&this.open()}return i(t,[{key:"debug",value:function(t){this.settings.debug&&console.warn(t)}},{key:"addListener",value:function(t,e){return this.emitter.addListener(t,e),this}},{key:"removeListener",value:function(t){return this.emitter.removeAllListeners(t),this}},{key:"send",value:function(t,e){var n=this;if(!t)throw"Must provide an event type, provided: "+t;if(!this.ws){if(!this.settings.autoReconnect)return this.debug("Tried to send event "+t+", but forced close was set. Please open the connection manually via #open!"),this;this.open()}switch(e||(e={}),"undefined"==typeof this.sendTries[t]&&(this.sendTries[t]=1),this.debug("Trying to send event "+t+" for the "+this.sendTries[t]+" time..."),this.ws.readyState){case WebSocket.CONNECTING:if(this.sendTries[t]>=this.settings.maxSendTries)return this.debug("WS still in connecting state, giving up after "+this.settings.maxSendTries+" tries for event "+t),this;this.sendTries[t]++,window.setTimeout(function(){n.send(t,e)},500);break;case WebSocket.CLOSING:case WebSocket.CLOSED:if(this.sendTries[t]>=this.settings.maxSendTries)return this.debug("WS still in closing state, giving up after "+this.settings.maxSendTries+" tries for event "+t),this;this.sendTries[t]++,this.open(!0),window.setTimeout(function(){n.send(t,e)},500);break;case WebSocket.OPEN:default:this.ws.send(JSON.stringify({type:t,payload:e})),this.sendTries[t]=1}return this}},{key:"open",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(this.settings.maxReconnects&&this.reconnectAttempts>=this.settings.maxReconnects)return this.debug("Maximal amount of reconnects reached, giving up! Please call #open by yourself to retry."),this;!e&&this.ws&&this.close(),this.emitter.emit("onBeforeWsOpen");var n=setTimeout(function(){t.debug("WS Connection timed out"),t.emitter.emit("onWsTimeout")},this.settings.timeoutInterval);return this.ws=new WebSocket(this.url,this.protocols),this.ws.binaryType=this.settings.binaryType,this.ws.addEventListener("open",function(e){clearTimeout(n),t.emitter.emit("onWsOpen",e,t),t.debug("WS connection successfully opened on attemp#"+t.reconnectAttempts+"."),t.reconnectAttempts=0,t.sendTries={}}),this.ws.addEventListener("message",function(e){t.emitter.emit("onWsMessage",e,t)}),this.ws.addEventListener("close",function(e){if(clearTimeout(n),t.emitter.emit("onWsClose",e,t),!t.forcedClose&&t.settings.autoReconnect){var s=t.settings.reconnectInterval*Math.pow(t.settings.reconnectDecay,t.reconnectAttempts);s>t.settings.maxReconnectTimeout&&(s=t.settings.maxReconnectTimeout),t.debug("Auto reconnect required, trying again in "+s+" ms..."),setTimeout(function(){t.reconnectAttempts++,t.open(!0),t.debug("WS connection timed out, trying to reconnect...")},s)}else t.forcedClose&&(t.forcedClose=!1,t.debug("WS forced closing the connection"))}),this.ws.addEventListener("error",function(e){t.emitter.emit("onWsError",e,t)}),this}},{key:"close",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1e3:arguments[0],e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return this.ws&&(this.forcedClose=!0,this.reconnectAttempts=0,this.sendTries={},this.ws.close(t,e),this.ws=null),this}}]),t}();e["default"]=o,t.exports=e["default"]},function(t,e,n){var s={EventEmitter:n(4)};t.exports=s},function(t,e,n){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(5),r=n(7),o=n(8),u=n(1),c=function(){function t(){s(this,t),this._subscriber=new r,this._currentSubscription=null}return t.prototype.addListener=function(t,e,n){return this._subscriber.addSubscription(t,new i(this._subscriber,e,n))},t.prototype.once=function(t,e,n){var s=this;return this.addListener(t,function(){s.removeCurrentListener(),e.apply(n,arguments)})},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription?void 0:u(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var e=this._subscriber.getSubscriptionsForType(t);return e?e.filter(o.thatReturnsTrue).map(function(t){return t.listener}):[]},t.prototype.emit=function(t){var e=this._subscriber.getSubscriptionsForType(t);if(e){for(var n=Object.keys(e),s=0;s<n.length;s++){var i=n[s],r=e[i];r&&(this._currentSubscription=r,this.__emitToSubscription.apply(this,[r].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,e){var n=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,n)},t}();t.exports=c},function(t,e,n){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=n(6),o=function(t){function e(n,i,r){s(this,e),t.call(this,n),this.listener=i,this.context=r}return i(e,t),e}(r);t.exports=o},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(e){n(this,t),this.subscriber=e}return t.prototype.remove=function(){this.subscriber.removeSubscription(this)},t}();t.exports=s},function(t,e,n){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1),r=function(){function t(){s(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,e){e.subscriber!==this?i(!1):void 0,this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var n=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(e),e.eventType=t,e.key=n,e},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var e=t.eventType,n=t.key,s=this._subscriptionsForType[e];s&&delete s[n]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=r},function(t,e){"use strict";function n(t){return function(){return t}}function s(){}s.thatReturns=n,s.thatReturnsFalse=n(!1),s.thatReturnsTrue=n(!0),s.thatReturnsNull=n(null),s.thatReturnsThis=function(){return this},s.thatReturnsArgument=function(t){return t},t.exports=s}]);
//# sourceMappingURL=index.js.map