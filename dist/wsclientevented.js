!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";var i=function(t){function e(n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.call(this,n),this.listener=i,this.context=r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(n(4));t.exports=i},function(t,e,n){"use strict";t.exports=function(t,e,n,i,r,s,o,c){if(!t){var u;if(void 0===e)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=[n,i,r,s,o,c],l=0;(u=new Error(e.replace(/%s/g,(function(){return a[l++]})))).name="Invariant Violation"}throw u.framesToPop=1,u}}},function(t,e,n){var i={EventEmitter:n(3),EmitterSubscription:n(0)};t.exports=i},function(t,e,n){"use strict";var i=n(0),r=n(5),s=n(6),o=n(1),c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriber=new r,this._currentSubscription=null}return t.prototype.addListener=function(t,e,n){return this._subscriber.addSubscription(t,new i(this._subscriber,e,n))},t.prototype.once=function(t,e,n){var i=this;return this.addListener(t,(function(){i.removeCurrentListener(),e.apply(n,arguments)}))},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription||o(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var e=this._subscriber.getSubscriptionsForType(t);return e?e.filter(s.thatReturnsTrue).map((function(t){return t.listener})):[]},t.prototype.emit=function(t){var e=this._subscriber.getSubscriptionsForType(t);if(e){for(var n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],s=e[r];s&&(this._currentSubscription=s,this.__emitToSubscription.apply(this,[s].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,e){var n=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,n)},t}();t.exports=c},function(t,e,n){"use strict";var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriber=e}return t.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},t}();t.exports=i},function(t,e,n){"use strict";var i=n(1),r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,e){e.subscriber!==this&&i(!1),this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var n=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(e),e.eventType=t,e.key=n,e},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var e=t.eventType,n=t.key,i=this._subscriptionsForType[e];i&&delete i[n]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=r},function(t,e,n){"use strict";function i(t){return function(){return t}}var r=function(){};r.thatReturns=i,r.thatReturnsFalse=i(!1),r.thatReturnsTrue=i(!0),r.thatReturnsNull=i(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(t){return t},t.exports=r},function(t,e,n){"use strict";n.r(e);var i=n(2);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var u=function(t,e){var n=JSON.parse(t.data);"object"===c(n)&&n.type&&e.emitter.emit(n.type,t,n)},a=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(this,t),this.emitter=new i.EventEmitter,this.url=e,this.protocols=r&&r.length>0?r:null,this.reconnectAttempts=0,this.forcedClose=!1,this.ws=null,this.sendTries={},this.settings={autoOpen:!0,autoReconnect:!0,debug:!1,forceCloseOnReload:!1,reconnectInterval:1e3,reconnectDecay:1.5,timeoutInterval:2e3,binaryType:"blob",payloadItemName:"payload",maxReconnects:null,maxSendTries:10,maxReconnectTimeout:5e3,onBeforeWsOpen:null,onWsOpen:null,onWsMessage:u.bind(this),onWsClose:null,onWsError:null,onMaxReconnects:null,onWsTimeout:null},Object.keys(o).forEach((function(t){n.settings[t]=o[t]})),["onBeforeWsOpen","onWsOpen","onWsMessage","onWsClose","onWsError","onMaxReconnects","onWsTimeout"].forEach((function(t){"function"==typeof n.settings[t]&&n.emitter.addListener(t,(function(e){n.settings[t](e,n)}))})),this.settings.autoOpen&&this.open(),this.settings.forceCloseOnReload&&self.addEventListener("beforeunload",(function(){n.close()}))}var e,n,c;return e=t,(n=[{key:"debug",value:function(t){this.settings.debug&&console.warn(t)}},{key:"addListener",value:function(t,e){return this.emitter.addListener(t,e),this}},{key:"removeListener",value:function(t){return this.emitter.removeAllListeners(t),this}},{key:"send",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw new Error("Must provide an event type, provided: ".concat(t));if(!this.ws){if(!this.settings.autoReconnect)return this.debug("Tried to send event ".concat(t,", but forced close was set. Please open the connection manually via #open!")),this;this.open()}switch(void 0===this.sendTries[t]&&(this.sendTries[t]=1),this.debug("Trying to send event ".concat(t," for the ").concat(this.sendTries[t]," time...")),this.ws.readyState){case WebSocket.CONNECTING:if(this.sendTries[t]>=this.settings.maxSendTries)return this.debug("WS still in connecting state, giving up after ".concat(this.settings.maxSendTries," tries for event ").concat(t)),this;this.sendTries[t]+=1,self.setTimeout((function(){e.send(t,n)}),500);break;case WebSocket.CLOSING:case WebSocket.CLOSED:if(this.sendTries[t]>=this.settings.maxSendTries)return this.debug("WS still in closing state, giving up after ".concat(this.settings.maxSendTries," tries for event ").concat(t)),this;this.sendTries[t]+=1,this.open(!0),self.setTimeout((function(){e.send(t,n)}),500);break;case WebSocket.OPEN:default:this.ws.send(JSON.stringify(r({type:t},this.settings.payloadItemName,n))),this.sendTries[t]=1}return this}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.settings.maxReconnects&&this.reconnectAttempts>=this.settings.maxReconnects)return this.debug("Maximal amount of reconnects reached, giving up! Please call #open by yourself to retry."),this.emitter.emit("onMaxReconnects"),this;!e&&this.ws&&this.close(),this.emitter.emit("onBeforeWsOpen");var n=setTimeout((function(){t.debug("WS Connection timed out"),t.emitter.emit("onWsTimeout")}),this.settings.timeoutInterval);return this.ws=new WebSocket(this.url,this.protocols),this.ws.binaryType=this.settings.binaryType,this.ws.addEventListener("open",(function(e){clearTimeout(n),t.emitter.emit("onWsOpen",e,t),t.debug("WS connection successfully opened on attemp#".concat(t.reconnectAttempts,".")),t.reconnectAttempts=0,t.sendTries={}})),this.ws.addEventListener("message",(function(e){t.emitter.emit("onWsMessage",e,t)})),this.ws.addEventListener("close",(function(e){if(clearTimeout(n),t.emitter.emit("onWsClose",e,t),!t.forcedClose&&t.settings.autoReconnect){var i=t.settings.reconnectInterval*Math.pow(t.settings.reconnectDecay,t.reconnectAttempts);i>t.settings.maxReconnectTimeout&&(i=t.settings.maxReconnectTimeout),t.debug("Auto reconnect required, trying again in ".concat(i," ms...")),setTimeout((function(){t.reconnectAttempts+=1,t.open(!0),t.debug("WS connection timed out, trying to reconnect...")}),i)}else t.forcedClose&&(t.forcedClose=!1,t.debug("WS forced closing the connection"))})),this.ws.addEventListener("error",(function(e){t.emitter.emit("onWsError",e,t)})),this}},{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.ws&&(this.forcedClose=!0,this.reconnectAttempts=0,this.sendTries={},this.ws.close(t,e),this.ws=null),this}}])&&o(e.prototype,n),c&&o(e,c),t}();window.WsClientEvented=a}]);
//# sourceMappingURL=wsclientevented.js.map